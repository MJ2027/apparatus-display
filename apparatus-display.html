<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engine 702 Apparatus Display</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: black;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
        }
        
        /* Standby Screen */
        .standby-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
        }
        
        .standby-logo {
            width: 400px;
            height: 400px;
            margin-bottom: 30px;
        }
        
        .standby-shift {
            font-size: 4em;
            font-weight: bold;
            color: #ff8800;
            margin-bottom: 20px;
        }
        
        .standby-time {
            font-size: 3em;
            color: #cccccc;
        }
        
        /* Alert Screen */
        .alert-screen {
            display: none;
            height: 100vh;
        }
        
        .alert-screen.active {
            display: flex;
            flex-direction: column;
        }
        
        .alert-header {
            background: rgba(255, 140, 0, 0.98);
            padding: 25px;
            text-align: center;
            font-size: 3em;
            font-weight: bold;
            border-bottom: 8px solid #ff6600;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        
        .alert-container {
            display: flex;
            flex: 1;
        }
        
        .alert-left {
            flex: 1;
            background: white;
            position: relative;
            border-right: 4px solid #333;
        }
        
        .alert-right {
            flex: 1;
            background: black;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .alert-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .alert-image {
            max-width: 98%;
            max-height: 98%;
            object-fit: contain;
            border: 3px solid #444;
        }
        
        .panel-label {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 12px 25px;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 8px;
            z-index: 100;
            border: 2px solid #ff8800;
        }
    </style>
</head>
<body>
    <!-- Standby Screen -->
    <div id="standbyScreen" class="standby-screen">
        <iframe src="http://10.2.1.111/FSASPortal/Pages/ScreenView.aspx?location=-1&limit=30&fsize=25&refresh=1" 
                style="width: 100%; height: 100%; border: none; background: black;">
        </iframe>
    </div>
    
    <!-- Alert Screen -->
    <div id="alertScreen" class="alert-screen">
        <div class="alert-header" id="alertHeader">ENGINE 702 - Loading...</div>
        <div class="alert-container">
            <div class="alert-left">
                <div class="panel-label">LOCATION MAP</div>
                <iframe id="mapsFrame" class="alert-iframe"></iframe>
            </div>
            <div class="alert-right">
                <div class="panel-label">BUILDING VIEW</div>
                <img id="streetViewImage" class="alert-image" alt="Street View">
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
       // Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAudqZKq4Ri84QS5hAMwQzIGmsUeRKNaPQ",
  authDomain: "tacoma-park-city-fire.firebaseapp.com",
  databaseURL: "https://tacoma-park-city-fire-default-rtdb.firebaseio.com",
  projectId: "tacoma-park-city-fire",
  storageBucket: "tacoma-park-city-fire.firebasestorage.app",
  messagingSenderId: "176769198060",
  appId: "1:176769198060:web:b0448742b90bf724e7c2c9"
};

        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // UI Elements
        const standbyScreen = document.getElementById('standbyScreen');
        const alertScreen = document.getElementById('alertScreen');
        const alertHeader = document.getElementById('alertHeader');
        const mapsFrame = document.getElementById('mapsFrame');
        const streetViewImage = document.getElementById('streetViewImage');
        
        let alertTimeout = null;
        
        // Show standby screen
        function showStandby() {
            standbyScreen.style.display = 'flex';
            alertScreen.classList.remove('active');
        }
        
        // Show alert screen
        function showAlert(address, mapsUrl, streetViewUrl) {
            console.log('[ALERT] Displaying:', address);
            
            // Update content
            alertHeader.textContent = `ENGINE 702 - ${address}`;
            
            // Convert search URL to embed URL for iframe compatibility
            // Extract coordinates or address from the URL and use Embed API
            let embedUrl = mapsUrl;
            if (mapsUrl.includes('query=')) {
                const query = mapsUrl.split('query=')[1].split('&')[0];
                embedUrl = `https://www.google.com/maps/embed/v1/place?key=AIzaSyDpkfbB4N_a2s0PPY_e7rt8o3R5efWa5wc&q=${query}&zoom=19`;
            }
            
            mapsFrame.src = embedUrl;
            streetViewImage.src = streetViewUrl;
            
            // Switch to alert screen
            standbyScreen.style.display = 'none';
            alertScreen.classList.add('active');
            
            // Clear any existing timeout
            if (alertTimeout) {
                clearTimeout(alertTimeout);
            }
            
            // Return to standby after 10 minutes
            alertTimeout = setTimeout(() => {
                console.log('[ALERT] Timeout - returning to standby');
                showStandby();
            }, 600000); // 10 minutes
        }
        
        // Listen for alert updates from Firebase
        database.ref('apparatus/current_alert').on('value', (snapshot) => {
            const alert = snapshot.val();
            
            if (alert && alert.active) {
                console.log('[FIREBASE] Alert received:', alert);
                showAlert(alert.address, alert.mapsUrl, alert.streetViewUrl);
            } else {
                console.log('[FIREBASE] No active alert');
                showStandby();
            }
        });
        
        // Initial state
        showStandby();
        
        console.log('[INIT] Apparatus display ready');
    </script>
</body>
</html>
